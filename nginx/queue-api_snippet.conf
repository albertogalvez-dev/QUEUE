# Queue API Reverse Proxy Configuration
# Place this inside your existing server block or include it.

location /projects/queue/api/ {
    # Trailing slash is important for proxy_pass to strip the path prefix if needed,
    # BUT since we use PathBase in the App, we want to Pass it through or strip it?
    # If app acts on /projects/queue/api/..., we pass it as is.
    # If app expects /, we use trailing slash in proxy_pass.
    
    # Deployment Strategy: "PathBase" in .NET
    # If QUEUE_PATH_BASE is set to /projects/queue/api, the app EXPECTS that prefix.
    # So we do NOT strip it.
    
    proxy_pass http://127.0.0.1:5150; # No trailing slash -> passes full URI
    
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection keep-alive;
    proxy_set_header Host $host;
    proxy_cache_bypass $http_upgrade;
    
    # Precision Headers
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    
    # Buffer settings (optional, good for API)
    proxy_buffering off;
    client_max_body_size 10M;
}
